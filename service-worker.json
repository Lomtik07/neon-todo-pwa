// service-worker.js - ПРОСТОЙ И РАБОЧИЙ
const CACHE_NAME = 'neon-todo-cache-v1';

// Установка
self.addEventListener('install', event => {
  console.log('[SW] Установка...');
  event.waitUntil(self.skipWaiting());
});

// Активация
self.addEventListener('activate', event => {
  console.log('[SW] Активация...');
  event.waitUntil(self.clients.claim());
});

// Синхронизация - ПРОСТАЯ И РАБОЧАЯ
self.addEventListener('sync', event => {
  console.log('[SW] Событие синхронизации:', event.tag);
  
  if (event.tag === 'sync-tasks') {
    event.waitUntil(
      new Promise(resolve => {
        console.log('[SW] Начинаем синхронизацию...');
        
        // Имитируем задержку
        setTimeout(() => {
          console.log('[SW] Синхронизация завершена');
          
          // Отправляем сообщение клиенту
          self.clients.matchAll().then(clients => {
            clients.forEach(client => {
              client.postMessage({
                type: 'SYNC_DONE',
                timestamp: new Date().toISOString()
              });
            });
          });
          
          resolve();
        }, 1000);
      })
    );
  }
});

// Простой перехват запросов
self.addEventListener('fetch', event => {
  event.respondWith(
    fetch(event.request).catch(() => {
      // Если офлайн, показываем главную страницу
      if (event.request.mode === 'navigate') {
        return caches.match('/');
      }
      return new Response('Офлайн');
    })
  );
});
